<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0.//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.spring.mml.MmlReplyDAO">
	
	 <resultMap type="com.spring.mml.Mml_ReplyVO" id="mmlReplyResultMap">
        <result property="mml_reply_code" column="mml_reply_code"/>
        <result property="id" column="id"/>
        <result property="mml_num" column="mml_num"/>
        <result property="mml_reply_content" column="mml_reply_content"/>
        <result property="mml_reply_write_date" column="mml_reply_write_date"/>
        <result property="mml_reply_update_date" column="mml_reply_update_date"/>
        <result property="mml_reply_like" column="mml_reply_like"/>
        <result property="mml_reply_dislike" column="mml_reply_dislike"/>
        <result property="mml_rep_warn_count" column="mml_rep_warn_count"/>
      
    </resultMap>
	
	<select id="mmlrlist" resultMap="mmlReplyResultMap">
        SELECT *
        FROM mml_reply
        WHERE mml_reply_code = #{mml_num}
        ORDER BY mml_reply_code DESC
    </select>

    <insert id="mmlrcreate">
	    <selectKey resultType="int" keyProperty="mml_reply_code" order="BEFORE">
	        SELECT mml_reply_code.NEXTVAL FROM dual        
	    </selectKey>
        INSERT INTO mml_reply 
        VALUES (
        	#{mml_reply_code}
            , #{id}
            , #{mml_num}
            , mml_reply_content
            , sysdate
            , sysdate
            , 0
            , 0
            , 0
            , 'N'
        )
    </insert>

    <update id="mmlrupdate">
        UPDATE mml_reply
        SET mml_reply_content = #{mml_reply_content}, mml_reply_update_date = sysdate
        WHERE mml_reply_code = #{mml_reply_code}
    </update>

    <delete id="mmlrdelete">
        DELETE FROM mml_reply
        WHERE mml_reply_code = #{replyNum}
    </delete>


	<!--  
    <select id="listPaging" resultMap="ReplyResultMap">
        SELECT
            bfr_rno
            , bfr_bno
            , id
            , bfr_regdate
            , bfr_like
            , bfr_dislike
            , bfr_update
            , bfr_alert
            , bfr_content
            , bfr_block
        FROM bf_reply
        INNER JOIN member ON id = id
        WHERE article_no = #{articleNo}
        ORDER BY reply_no DESC
        LIMIT #{criteria.pageStart}, #{criteria.perPageNum}
    </select>
    -->
    <select id="mmlrlistPaging" resultMap="mmlReplyResultMap">
	  <![CDATA[
		   select rn,
		 	mml_reply_code
            , id
            , mml_num
            , mml_reply_content
            , mml_reply_write_date
            , mml_reply_update_date
            , mml_reply_like
            , mml_reply_dislike
            , mml_rep_warn_count
          
		 from 
            (select
            rownum rn
            , mml_reply_code
            , id
            , mml_num
            , mml_reply_content
            , mml_reply_write_date
            , mml_reply_update_date
            , mml_reply_like
            , mml_reply_dislike
            , mml_rep_warn_count
         
            from
		   (
		    select
		    mml_reply_code
            , id
            , mml_num
            , mml_reply_content
            , mml_reply_write_date
            , mml_reply_update_date
            , mml_reply_like
            , mml_reply_dislike
            , mml_rep_warn_count
          
		    from mml_reply
		    where mml_num =  #{mml_num}
		    and mml_reply_code > 0	    
            order by mml_reply_code desc
		   )) where rn > (#{page} -1) *#{perPageNum} and rn <= #{page} * #{perPageNum}
		]]>
	</select>
    

    <select id="mmlrcountReplies" resultType="int">
        SELECT
            COUNT(mml_num)
        FROM mml_reply
        WHERE mml_num = #{boardNum}
    </select>

    <select id="mmlrgetArticleNo" resultType="int">
        SELECT
            mml_num
        FROM mml_reply
        WHERE mml_reply_code = #{replyNo}
    </select>

   
</mapper>